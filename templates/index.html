<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Cheap_Snake Game Deals</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}"><!--loads css file for styling-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script><!--loads jquery for autocomplete-->
    <script src="{{ url_for('static', filename='script.js') }}"></script><!--loads js file-->
</head>

<body>
    <h1>Cheap_Snake Game Deals</h1>
    <a href="/" style="padding: 0.5em 1em; background-color: #4b0082; color: white; border-radius: 5px; text-decoration: none; margin-bottom: 1em; display: inline-block;">
    üêç Home
    </a>

    <!--search box, pulls suggestions from script.js for autocomplete-->
    <form method="POST" action="/search">

        <input type="text" name="title" id="search-input" autocomplete="off" placeholder="Enter Game Name" required>
        <button type="submit">Ssssearch...</button>
        <ul id="suggestions" class="suggestions"></ul>
    </form>

    <!--data from flask is looped through, finds thumbnail, price, store name using store map, and link to game-->
    {% if deals %}
        <h2>{{ title }}</h2>


        <ul class="card-grid">
        {% for deal in deals %}
            <li class="card">
            <div class="card-content">
                <div class="card-image-container">
                    {% if deal.steamAppID %}
                        <img src="https://cdn.cloudflare.steamstatic.com/steam/apps/{{ deal.steamAppID }}/header.jpg" alt="Steam Banner">
                    {% elif deal.thumb %}
                        <img src="{{ deal.thumb }}" alt="Thumbnail">
                    {% else %}
                        <span style="color: #999; font-size: 0.9em;">no thumbnail... sorry!</span>
                    {% endif %}
                </div>

                <div class="card-info">
                <h3>{{ deal.title }}</h3>
                <p><strong>${{ "%.2f"|format(deal.salePrice|float) }}</strong></p>
                </div>

                <div class="card-hover">
                <div class="hover-info">
                    <p><strong>Sale Price:</strong> ${{ "%.2f"|format(deal.salePrice|float) }}</p>
                    <p><strong>Original Price:</strong> ${{ "%.2f"|format(deal.normalPrice|float) }}</p>

                    {% if deal.savings %}
                    <p><strong>Discount:</strong> {{ "%.0f"|format(deal.savings|float) }}% Off</p>
                    {% endif %}

                    {% set rating = deal.dealRating|float %}
                    {% if rating %}
                    <p><strong>Deal Rating:</strong> {{ rating|int if rating == 10 else "%.1f"|format(rating) }}/10</p>
                    {% endif %}


                    {% if deal.steamRatingText and deal.steamRatingPercent %}
                    <p><strong>Steam Rating:</strong> {{ deal.steamRatingText }} ({{ deal.steamRatingPercent }}%)</p>
                    {% endif %}

                    {% if deal.metacriticScore %}
                    <p><strong>Metacritic Rating:</strong> {{ deal.metacriticScore }}</p>
                    {% endif %}

                    {% set store = store_map.get(deal.storeID, {}) %}
                    {% if store %}
                    <p>
                        <img src="https://www.cheapshark.com{{ store.images.icon }}" style="height: 20px; vertical-align: middle;">
                        {{ store.storeName }}
                    </p>
                    {% endif %}
                </div>

                <a class="buy-button" href="https://www.cheapshark.com/redirect?dealID={{ deal.dealID }}" target="_blank">
                    Purchase üõí
                </a>
                </div>

            </div>
            </li>
        {% endfor %}
        </ul>

    {% endif %}
</body>

<footer class="footer">
  <p>made with sass by code_blooded</p>
</footer>

</html>
